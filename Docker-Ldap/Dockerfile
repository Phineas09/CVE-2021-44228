FROM alpine:latest
FROM python:3

WORKDIR /home/jndi/log4shell

# Install dependencies
COPY requirements.txt ./

RUN pip install --no-cache-dir -r requirements.txt

# Install exe
COPY exploit_generator.py ./

COPY run.sh ./

# Copy JAR
COPY java/marshalsec-0.0.3-SNAPSHOT-all.jar ./marshalsec-0.0.3-SNAPSHOT-all.jar

# Download jdk-8u20-linux-x64.tar.gz from google drive

RUN wget --load-cookies /tmp/cookies.txt \ 
    "https://docs.google.com/uc?export=download&confirm=$(wget --quiet --save-cookies /tmp/cookies.txt --keep-session-cookies --no-check-certificate 'https://docs.google.com/uc?export=download&id=1WP2ncclnbViIkGwhfAaVesFoTiVFTCjQ' -O- | sed -rn 's/.*confirm=([0-9A-Za-z_]+).*/\1\n/p')&id=1WP2ncclnbViIkGwhfAaVesFoTiVFTCjQ" -O ./jdk-8u20-linux-x64.tar.gz  && rm -rf /tmp/cookies.txt

# Unzip it

RUN tar -xf ./jdk-8u20-linux-x64.tar.gz

# LDAP Server
EXPOSE 8000 
# JNDI server
EXPOSE 1389

CMD ["/bin/bash", "run.sh"]
